
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://energygreek.github.io/notes/blog/page/8/">
      
      
      
        <link rel="next" href="../../archive/2025/">
      
      
        
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Recent Blog - Some Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recent-blog" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Some Notes" class="md-header__button md-logo" aria-label="Some Notes" data-md-component="logo">
      
  <img src="../../../assets/bird.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Some Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Recent Blog
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="gray" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tags/" class="md-tabs__link">
        
  
  
    
  
  Tag

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Some Notes" class="md-nav__button md-logo" aria-label="Some Notes" data-md-component="logo">
      
  <img src="../../../assets/bird.png" alt="logo">

    </a>
    Some Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tag
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      
        c++的信号和异常
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux定时器
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        docker storage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        起因
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    <span class="md-ellipsis">
      
        shell 中文件操作接口
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-sftp-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        setup sftp service
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-arguement-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        python arguement types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    <span class="md-ellipsis">
      
        bash使用技巧收集
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go" class="md-nav__link">
    <span class="md-ellipsis">
      
        go 学习笔记
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      
        c++ 存储周期、链接和作用域
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="recent-blog">Recent Blog<a class="headerlink" href="#recent-blog" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-09-16 00:00:00+00:00">2021年9月16日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="c"><a class="toclink" href="../../c-%E4%BF%A1%E5%8F%B7%E5%92%8C%E5%BC%82%E5%B8%B8/">c++的信号和异常</a></h2>
<p>信号和异常都是c++程序会遇到的，以前常把信号也当异常来看待，当其实两者是截然不同的东西</p>
<h3 id="_1"><a class="toclink" href="../../c-%E4%BF%A1%E5%8F%B7%E5%92%8C%E5%BC%82%E5%B8%B8/#_1">信号</a></h3>
<p>信号不仅是对c++程序，而是对所有linux程序，是内核<code>在进程由内核态转用户态</code>时，检查信号槽并调用信号处理函数（用户定义或者默认）。<br />
有些信号可以由程序处理（常见退出信号SIGINT），而有些无法处理（常见退出信号SIGABT, 段错误信号SIGSEGV），而大多信号默认是退出进程。</p>
<h3 id="_2"><a class="toclink" href="../../c-%E4%BF%A1%E5%8F%B7%E5%92%8C%E5%BC%82%E5%B8%B8/#_2">异常</a></h3>
<p>c++的异常是c所没有的，异常一般在出现<code>逻辑错误</code>和<code>运行时错误</code>时要抛出异常，如果没有异常处理函数，则coredump。</p>
<h3 id="_3"><a class="toclink" href="../../c-%E4%BF%A1%E5%8F%B7%E5%92%8C%E5%BC%82%E5%B8%B8/#_3">触发方式</a></h3>
<p>触发信号用raise，而异常用trow 
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">raise</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">);</span>
</code></pre></div></p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-08-24 00:00:00+00:00">2021年8月24日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="linux"><a class="toclink" href="../../linux%E5%AE%9A%E6%97%B6%E5%99%A8/">Linux定时器</a></h2>
<p>https://www.computerhope.com/unix/ucrontab.htm#command-entries</p>
<h3 id="systemd-run"><a class="toclink" href="../../linux%E5%AE%9A%E6%97%B6%E5%99%A8/#systemd-run">使用systemd-run 替换</a></h3>
<div class="highlight"><pre><span></span><code># systemd-run --on-active=30 /bin/touch /tmp/foo
# systemd-run --on-active=&quot;12h 30m&quot; --unit some-unit.service
</code></pre></div>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-08-13 00:00:00+00:00">2021年8月13日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="docker-storage"><a class="toclink" href="../../docker-storage/">docker storage</a></h2>
<p>docker 有3种方式使用系统存储:</p>
<ul>
<li>bind: 
  宿主机目录映射方式，启动容器命令添加参数<code>-v dir1:dir2</code>。将宿主机的目录dir1挂载到容器的dir2目录，实际执行的<code>mount -o bind</code>类似命令</li>
<li>volume: 
  由docker管理的存储，先创建后使用，且可以在多个容器中共享，是官方推荐的方式</li>
<li>tmpfs: 
  使用宿主机的内存作为存储，这种使用内存文件系统来挂载到容器目录, 使用参数<code>--mount type=tmpfs,destination=/dir</code>, tmpfs是退出即释放的一种文件系统</li>
</ul>
<h3 id="docker"><a class="toclink" href="../../docker-storage/#docker">docker使用的文件系统</a></h3>
<p>docker使用的文件系统经过很多变化，而且在各发行版下可能不同，但目前主流的是overlay2，执行<code>docker info</code> 查看当前使用的是overlay2
<div class="highlight"><pre><span></span><code>sudo docker info | grep  Storage                                                                                                                                              
 Storage Driver: overlay2
</code></pre></div></p>
<p>除了overlay2，还有aufs（ubuntu），devicemapper（centos），btrfs和zfs。他们的实现都不同，都能支持分层和支持写时复制（Cow/copy-on-write），而他们实现的方式有区别，所以效率也有区别</p>
<ul>
<li>分层：
镜像都是分层的，在Dockerfile构建时，每次执行COPY/RUN时，都会增加一层</li>
<li>写时复制:
在容器或者DockerFile执行修改操作时，包括权限修改，会将lower layer 的文件复制到container层再修改</li>
</ul>
<p>而容器就是在镜像顶层<code>压栈</code>了一个<code>可写</code>层，而且是临时的，当容器销毁时，这层的文件也会删除</p>
<h3 id="overlay"><a class="toclink" href="../../docker-storage/#overlay">overlay的优势</a></h3>
<ol>
<li>page caching， 可以在多个不同实例之间共享</li>
<li>不同层之间，相同文件使用硬连接， 节省inode 和 大小</li>
</ol>
<p>写时复制 copy-up 会导致第一次写时造成延迟，特别是大文件，拷贝起来费时。 但第二次就不会延时， 而且overlay2 有caching， 相比其它文件系统，更减少延时</p>
<h3 id="overlay_1"><a class="toclink" href="../../docker-storage/#overlay_1">overlay的问题</a></h3>
<ol>
<li>实现不够完全， 例如没有实现uname </li>
<li>先只读打开一个文件 open（read）， 再读写打开相同文件open（write）， 两个fd 会对应2个不同文件， 第一个对应的lower的文件，第二个造成写时复制，对应容器里的文件。 </li>
<li>规避方法是先执行touch 操作。 现实的例子是 yum 需要安装yum-plugin-ovl。 但这个只有7.2才支持， 之前的话就需要先<code>touch /var/lib/rpm/*</code></li>
</ol>
<h3 id="_1"><a class="toclink" href="../../docker-storage/#_1">最佳实践</a></h3>
<ol>
<li>使用ssd </li>
<li>对于写操作比较多的场景，例如数据库，应使用映射文件(bind)或者volume。这样跳过了overlay的复杂操作，直接使用主机的文件系统</li>
</ol>
<h3 id="overlay_2"><a class="toclink" href="../../docker-storage/#overlay_2">overlay的增删改</a></h3>
<p>当运行docker容器时查看挂载</p>
<p><div class="highlight"><pre><span></span><code>overlay on /var/lib/docker/overlay2/04ea1faa8074e5862f40eecdba968bd9b7f222cb30e5bf6a0b9a9c48be0940f2/merged type overlay (rw,relatime,lowerdir=/var/lib/docker/overlay2/l/B74PWZCBMRCWXFH5UL2ZXB5WEU:/var/lib/docker/overlay2/l/WNHICVPVSDNUGSCZW435TPSMOK,upperdir=/var/lib/docker/overlay2/04ea1faa8074e5862f40eecdba968bd9b7f222cb30e5bf6a0b9a9c48be0940f2/diff,workdir=/var/lib/docker/overlay2/04ea1faa8074e5862f40eecdba968bd9b7f222cb30e5bf6a0b9a9c48be0940f2/work)
</code></pre></div>
docker 将镜像的文件挂载为只读， 将容器层挂载为可读可写。 文件系统可以分为2部分
upper（容器层） + lower （镜像层）</p>
<ul>
<li>当在容器里执行写时， 如果文件不存在， 会依次遍历lower。如果都不存在就会在upper层创建文件</li>
<li>读也相同</li>
<li>删除时会创建一个without 来隐藏， 这是为什么即使删除容器里的文件， 镜像还是会增大。 </li>
<li>删除目录情况也差不多</li>
</ul>
<h3 id="_2"><a class="toclink" href="../../docker-storage/#_2">特殊情况</a></h3>
<p>在保存容器后(docker commit)，会多一层，里面包含了修改的文件，以及删除后生成的without文件，然后生成镜像</p>
<p>但对于以下特殊目录文件不会提交， 因为这些文件是运行时docker 要根据用户配置进行修改的。  </p>
<ol>
<li>/etc/hostname </li>
<li>/etc/hosts </li>
<li>/etc/resov.conf</li>
</ol>
<p>例如docker 的link选项，会在容器的hosts 文件里定义对应的容器名-&gt;容器ip</p>
<h3 id="mount-overlayfs"><a class="toclink" href="../../docker-storage/#mount-overlayfs">手动mount overlayfs的例子</a></h3>
<ol>
<li>原本目录，文件都分散在不同目录ABC
<div class="highlight"><pre><span></span><code>.
├── A
│   ├── aa
│   └── a.txt
├── B
│   ├── a.txt
│   └── b.txt
├── C
│   └── c.txt
└── worker
    └── work [error opening dir]
</code></pre></div></li>
<li>overlay 挂载到/tmp/test目录 <code>sudo mount -t overlay overlay -o lowerdir=A:B,upperdir=C,workdir=worker /tmp/test/</code></li>
<li>查看test目录 
<div class="highlight"><pre><span></span><code>/tmp/test/
├── aa
├── a.txt
├── b.txt
└── c.txt
</code></pre></div>
<div class="highlight"><pre><span></span><code>mount  | grep &#39;overlay&#39;
overlay on /tmp/test type overlay (rw,relatime,lowerdir=A:B,upperdir=C,workdir=worker)
</code></pre></div></li>
</ol>
<h3 id="_3"><a class="toclink" href="../../docker-storage/#_3">参考</a></h3>
<p>https://docs.docker.com/storage/storagedriver/</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-08-02 00:00:00+00:00">2021年8月2日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="_1"><a class="toclink" href="../../%E8%BE%93%E5%87%BA%E7%BC%93%E5%86%B2%E5%92%8Cstdbuf/">起因</a></h2>
<p>遇到过一个面试题, 以下程序打印几个'A'
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">fork</span><span class="p">();</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
答案是4个,而以下是3个
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;A</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">fork</span><span class="p">();</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
再把上面的编译后的可执行文件重定向到文件, 则有4个'A'
<div class="highlight"><pre><span></span><code><span class="cp">#./a.out &gt; r.log</span>
<span class="cp">#cat r.log</span>
</code></pre></div>
原因就是缓冲 </p>
<h3 id="linux"><a class="toclink" href="../../%E8%BE%93%E5%87%BA%E7%BC%93%E5%86%B2%E5%92%8Cstdbuf/#linux">Linux 缓冲介绍</a></h3>
<p>分为无缓冲、行缓冲和全缓冲</p>
<h3 id="_2"><a class="toclink" href="../../%E8%BE%93%E5%87%BA%E7%BC%93%E5%86%B2%E5%92%8Cstdbuf/#_2">演示</a></h3>
<p>发现有些程序可以输出到屏幕，重定向到文件后，执行<code>ctl+c</code>退出后却没有任何内容，例如以下</p>
<p><div class="highlight"><pre><span></span><code>#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main(void) {
  while (1) {
    printf(&quot;Hello World\n&quot;);
    sleep(1);
  }
}
</code></pre></div>
这个程序是死循环所以需要手动结束，且一直打印helloword。但如果将输出重定向到文件，</p>
<p><div class="highlight"><pre><span></span><code>#./a.out &gt; r.log
</code></pre></div>
当手动退出时，文件依旧是空的</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-07-07 00:00:00+00:00">2021年7月7日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="shell"><a class="toclink" href="../../shell-%E4%B8%AD%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3/">shell 中文件操作接口</a></h2>
<h3 id="_1"><a class="toclink" href="../../shell-%E4%B8%AD%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3/#_1">读行</a></h3>
<div class="highlight"><pre><span></span><code>while read line ;do
#or while read -r line ;do
echo $line
done &lt; $1
</code></pre></div>
<div class="highlight"><pre><span></span><code>cat $1 | while read line ;do
echo $line
done
</code></pre></div>
<p>使用for时，结果略有不同, for以空格为一行
<div class="highlight"><pre><span></span><code>for line in $(cat $1) ;do
echo $line
done
</code></pre></div></p>
<h3 id="reference"><a class="toclink" href="../../shell-%E4%B8%AD%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3/#reference">reference</a></h3>
<p>https://bash.cyberciti.biz/guide/Reads_from_the_file_descriptor_(fd)</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-06-25 00:00:00+00:00">2021年6月25日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="setup-sftp-service"><a class="toclink" href="../../setup-sftp-service/">setup sftp service</a></h2>
<h3 id="curlfs-sshfs"><a class="toclink" href="../../setup-sftp-service/#curlfs-sshfs">curlfs 和 sshfs 客户端</a></h3>
<p>在debian上，之前一直用curlfs工具，将远程目录mount到本地目录。系统升级之后发现这个包没有了， 原来因为ftp不安全，所以现在推荐sshfs。</p>
<h3 id="reference"><a class="toclink" href="../../setup-sftp-service/#reference">reference</a></h3>
<p>https://www.linuxtechi.com/configure-sftp-chroot-debian10/</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-06-18 10:44:05+00:00">2021年6月18日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="python-arguement-types"><a class="toclink" href="../../python-arguement-types/">python arguement types</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># accept tupe and list</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calc</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">n</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>

<span class="n">calc</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">calc</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># accept varidict argument</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calc2</span><span class="p">(</span><span class="o">*</span><span class="n">numbers</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">n</span>
    <span class="k">return</span> <span class="nb">sum</span>

<span class="n">calc2</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">calc2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># transform list to varidcit argument</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="o">*</span><span class="n">numbers</span><span class="p">))</span>


<span class="c1"># varidict named arguments will be transformed to dict</span>

<span class="c1"># only accept named varidict argument</span>
<span class="k">def</span><span class="w"> </span><span class="nf">person2</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;hello&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
        <span class="n">passs</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

<span class="c1"># accept compose argument in sequence: normal argument &amp; named varidict argument</span>
<span class="k">def</span><span class="w"> </span><span class="nf">person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>

<span class="n">person</span><span class="p">(</span><span class="s1">&#39;mike&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">person</span><span class="p">(</span><span class="s1">&#39;mike&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">)</span>
<span class="n">person</span><span class="p">(</span><span class="s1">&#39;mike&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="n">birth</span><span class="o">=</span><span class="mi">1990</span><span class="p">)</span>
<span class="n">person2</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mike&#39;</span><span class="p">,</span><span class="n">age</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="n">birth</span><span class="o">=</span><span class="mi">1990</span><span class="p">)</span>

<span class="c1"># compose normal type argument, varidict type argument, and varidict named type argument </span>
<span class="k">def</span><span class="w"> </span><span class="nf">f2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b =&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;c =&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;d =&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;kw =&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>

<span class="n">cs</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">f2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">*</span><span class="n">cs</span><span class="p">,</span><span class="n">hello</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>


<span class="c1"># use * to sepcify named type argument</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b =&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;c =&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;d =&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;e =&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="c1"># don&#39;t accept other named argument</span>
<span class="n">f3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># use tupe and dict can call all kind of function</span>
<span class="c1"># so *arg and **kw are always used to forward all argument to another function of any type of argument</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="n">f2</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="c1"># at last, use base type for default value</span>
</code></pre></div>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-05-21 00:00:00+00:00">2021年5月21日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="bash"><a class="toclink" href="../../bash-learning/">bash使用技巧收集</a></h2>
<p>Linux的命令行是非常强大的生产工具，现实中的问题好多可以不写复杂的编程代码而通过命令来解决, 而且不过几行代码而已  </p>
<h3 id="shell"><a class="toclink" href="../../bash-learning/#shell">shell 内建命令</a></h3>
<p>当执行which的时候，比如<code>which echo</code> 会输出'shell built-in command'而不是返回路径，就说明这个命令是内建命令<br />
shell在执行内建命令时是直接执行，而非内建命令则fork一个子进程来执行</p>
<h3 id="buffpipedelimiter"><a class="toclink" href="../../bash-learning/#buffpipedelimiter">命令行的问题很多与缓冲buff、重定向pipe、delimiter分割符有关</a></h3>
<h3 id="_1"><a class="toclink" href="../../bash-learning/#_1">技巧, 用命令代替编程</a></h3>
<h4 id="xargs"><a class="toclink" href="../../bash-learning/#xargs">使用xargs创建多进程并发</a></h4>
<p>xargs可以将输入多进程并发处理，配合<code>find</code> 非常厉害。 配合wget就是一个并发爬虫了</p>
<div class="highlight"><pre><span></span><code>EXAMPLES
       find /tmp -name core -type f -print | xargs /bin/rm -f

       Find files named core in or below the directory /tmp and delete them.  Note that this will work incorrectly if there are any filenames containing newlines or spaces.

       find /tmp -name core -type f -print0 | xargs -0 /bin/rm -f

       Find files named core in or below the directory /tmp and delete them, processing filenames in such a way that file or directory names containing spaces or newlines  are  correctly
       handled.

       find /tmp -depth -name core -type f -delete

       Find  files  named  core in or below the directory /tmp and delete them, but more efficiently than in the previous example (because we avoid the need to use fork(2) and exec(2) to
       launch rm and we don&#39;t need the extra xargs process).

       cut -d: -f1 &lt; /etc/passwd | sort | xargs echo

       Generates a compact listing of all the users on the system.
</code></pre></div>
<h3 id="find-exec"><a class="toclink" href="../../bash-learning/#find-exec">find -exec 用法</a></h3>
<p><div class="highlight"><pre><span></span><code>find . -exec grep chrome {} \;
find . -exec grep chrome {} +
</code></pre></div>
1. \; 是转义;
2. {} 会替换成 find出的文件名。
2. ; 和 + 的区别是： 当;时，grep命令会在每个文件名上执行一次，grep执行多次， 但+时，所有的文件名会将所有的文件名一次进行grep，grep执行一次。</p>
<h4 id="awk-ors"><a class="toclink" href="../../bash-learning/#awk-ors">使用awk ORS 分割结果</a></h4>
<p>ls 本来是行分隔的
awk将ls的换行符变为|分割
<div class="highlight"><pre><span></span><code>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ ORS=&quot;|&quot;; print; }&#39;</span>
</code></pre></div>
而<code>echo $(ls)</code> 则把ls的换行符变为空格</p>
<h4 id="declare"><a class="toclink" href="../../bash-learning/#declare">使用declare 声明变量的类型和属性</a></h4>
<p>declare可以指定变量的类型'-i'为整形，'-r'制度(等同shell的readonly)，'-g'全局变量
shell默认是字符串，使用'-i'后，数学运算不需要<code>let</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">#retry=0</span>
<span class="nb">declare</span><span class="w"> </span>-i<span class="w"> </span><span class="nv">retry</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$retry</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
ps<span class="w"> </span>aux<span class="w"> </span>--cols<span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>xxx
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<span class="k">fi</span>
sleep<span class="w"> </span><span class="m">1</span>
<span class="c1">#let retry=$retry+1</span>
<span class="nv">retry</span><span class="o">=</span><span class="nv">$retry</span>+1
<span class="k">done</span>
</code></pre></div>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-05-21 00:00:00+00:00">2021年5月21日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="go"><a class="toclink" href="../../go-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">go 学习笔记</a></h2>
<h3 id="go_1"><a class="toclink" href="../../go-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#go_1">go为什么要指针和什么时候必须用指针</a></h3>
<ol>
<li>传递waitgroup时</li>
<li>获取命令行参数</li>
</ol>
<h3 id="_1"><a class="toclink" href="../../go-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_1">全局变量和多变量赋值问题</a></h3>
<p>因为很多函数需要处理error, 当存在全局变量时，可能会覆盖全局变量</p>
<p><div class="highlight"><pre><span></span><code>var global_var int = 1
func foo(){
  // 此时覆盖了全局变量
  global_var, err := os.OpenFile(&quot;file&quot;)
}
</code></pre></div>
应改为
<div class="highlight"><pre><span></span><code>var global_var int = 1
func foo(){
  var err error
  global_var, error = os.OpenFile(&quot;file&quot;)
}
</code></pre></div></p>
<h3 id="slice"><a class="toclink" href="../../go-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#slice">数组和slice的区别</a></h3>
<p>数组和slice使用上如同c++里的std::array和std::vector, 数组的长度固定，slice长度可以2倍扩容<br />
但有传参上有大区别: golang中数组是值传递，相当于将整个数组复制一遍，而slice是引用传递，所以slice用得多，map同理  </p>
<p>定义数组和slice:
<div class="highlight"><pre><span></span><code><span class="c1">// 数组</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span>
<span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">array2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">}</span>
<span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span><span class="w"> </span><span class="c1">// 省略长度</span>
<span class="nx">q2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="c1">// 前99项为0,第100个元素是-1</span>

<span class="c1">// slice</span>
<span class="nx">s1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w">  </span><span class="c1">//a是数组</span>
<span class="nx">s2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="w">         </span>
<span class="nx">s3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span>
</code></pre></div></p>
<h3 id="var-make"><a class="toclink" href="../../go-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#var-make">var 和 := 区别, 以及哪些类型需要make</a></h3>
<p>两者很多时候可以相互替换，但是在不同类型上，有区别</p>
<p>对于基本类型string, int, boolean, 数组，var<code>声明</code>即初始化
<div class="highlight"><pre><span></span><code>var str string // 自动初始化为空字符串
var inter int // 自动初始化为0
var bo bool // 自动初始化为false

// 可以直接使用
fmt.Printf(&quot;%s %d %t&quot;, str, inter, bo) 
</code></pre></div></p>
<p>而对于slice, map, chann类型而言, 使用<code>var m map[int]string</code>只是声明，需要再用<code>make</code>来获得内存和初始化
<div class="highlight"><pre><span></span><code>var m map[int] string // 此时不能使用m
m = make(map[int] string){1:&quot;a&quot;,2:&quot;b&quot;}
fmt.Println(m[1])
</code></pre></div>
而上面的步骤可以简化成
<div class="highlight"><pre><span></span><code>m := make(map[int] string){1:&quot;a&quot;, 2:&quot;b&quot;}
</code></pre></div>
或直接
<div class="highlight"><pre><span></span><code>m := map[int] string{1:&quot;a&quot;, 2:&quot;b&quot;}
</code></pre></div></p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-04-29 00:00:00+00:00">2021年4月29日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="c"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/">c++ 存储周期、链接和作用域</a></h2>
<h3 id="c_1"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#c_1">c++中变量和函数的三个重要属性</a></h3>
<p>存储周期类型： 有关变量的创建和销毁
链接类型： 有关变量函数的内存位置
作用域: 有关变量函数的可见范围</p>
<p>本文讨论的标识符，包括变量和函数</p>
<h3 id="_1"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#_1">存储说明符</a></h3>
<p><code>存储说明符</code>控制变量何时分配和释放，有以下几种</p>
<ul>
<li>automatic</li>
<li>thread_local</li>
<li>static </li>
<li>register</li>
<li>mutable</li>
<li>extern</li>
</ul>
<p>说明
- automatic: 最常见的局部变量，且没有声明为static或者thread_local，位于栈上, 随着代码块的执行和结束而自动分配和销毁
- static: 静态变量, 在程序启动和结束时创建和销毁，但初始化是在第一次执行初始化代码时执行
- thread: 在线程开始和结束时分配和销毁
- dynamic: 最常见的堆上的变量, 需要执行new和delete, </p>
<p>auto 在c++11中不是声明存储周期，而是类型推导符, 但这种存储周期类型的依然存在（局部变量）  </p>
<h3 id="_2"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#_2">初始化的时机</a></h3>
<ul>
<li>automatic: 必须手动初始化，换句话说局部变量必须初始化，否则值为不确定</li>
<li>static: 在执行时初始化，且初始化一次，特殊情况下在执行前初始化</li>
<li>thread: 因为thread_local变量自带static性质，所以认为其同于static</li>
<li>dynamic: 在new时初始化</li>
</ul>
<h3 id="linkage"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#linkage">Linkage</a></h3>
<p>标识符（变量&amp;函数）用一块内存里的值或者函数体来表示的， 而linkage决定其他相同的标识符是否指向同一块内存。c/c++有3种linkage, no-linkage, internal linkage和external linkage</p>
<ul>
<li>no linkage 局部变量没有linkage, 所以两个a是独立的，后面的a会覆盖前面的a，不相干。此时linkage与可见域(scope)类似</li>
<li>internal linkage 表示只能在文件内部访问(file scope)，换句话就是不会暴露给链接器， 用修饰符<code>static</code>声明internal linkage，所以允许在不同文件声明两个名称&amp;类型相同的internal linkage 标识符，他们指向不同的内存单元。 </li>
<li>external linkage 表示可以在程序所有地方访问，包括外部文件(global scope)，所以是真“全局”（scope&amp;linkage）， 所有标识符指向独一份内存。</li>
</ul>
<h4 id="_3"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#_3">修饰符</a></h4>
<ul>
<li>全局const变量和全局constexpr变量默认具备internal linkage, 再加上<code>static</code>没有影响</li>
<li>全局非const变量默认是external linkage， 故再加上extern没有影响。在其他文件使用<code>extern</code>声明这个变量，就能使用指向同一内存的变量</li>
<li>函数默认external linkage，故再加上extern没有影响。 在其他文件使用<code>extern</code>声明这个函数（可省），就能使用指向同一内存的函数</li>
<li>使用extern修饰全局const变量和constexpr变量可以使起具备external linkage</li>
</ul>
<p>可见<code>static</code>和<code>extern</code>即表示存储周期，又表示linkage， static相对简单，extern则比较复杂，如以下情况
<div class="highlight"><pre><span></span><code>int g_x = 1; // 定义有初始化的全局变量（可加可不加extern）
int g_x; // 定义没有初始化的全局变量（不可加extern），可选初始化
extern int g_x; // 前置声明一个全局变量，不可初始化

extern const int g_y { 1 }; // 定义全局常量，const必须初始化
extern const int g_y; // 前置声明全局常量，不可初始化
</code></pre></div></p>
<p>所以若是定义未初始化的全局变量，不能加extern，不然就成了前置声明了。</p>
<h4 id="constexpr"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#constexpr">constexpr 特殊情况</a></h4>
<p>虽然通过给constexpr添加<code>extern</code>修饰符来让其具备external属性，但不能在其他文件前置声明。因为constexpr是在编译期替换的，编译器（compile)的可见域限定在文件内，所以编译期无法知道constexpr的值，所以在编译期无法获取到其内存单元的值， 也就无法在其他文件进行声明，只能定义。</p>
<h3 id="file-scopeglobal-scope"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#file-scopeglobal-scope">file scope和global scope</a></h3>
<p>局部变量的scope、no-linkage以及duration相同，从<code>{</code>开始到<code>}</code>结束。 理论上global scope涵盖了file scope。而linkage来规定其是否能在其他文件里使用。</p>
<h3 id="local-class"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#local-class">local class</a></h3>
<p>local class 不允许有static data member</p>
<h3 id="_4"><a class="toclink" href="../../c-%E5%AD%98%E5%82%A8%E5%91%A8%E6%9C%9F%E9%93%BE%E6%8E%A5%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F/#_4">参考</a></h3>
<p>https://en.cppreference.com/w/cpp/language/storage_duration</p>
    
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../6/">6</a> <a class="md-pagination__link" href="../7/">7</a> <span class="md-pagination__current">8</span> <a class="md-pagination__link" href="../9/">9</a> <a class="md-pagination__link" href="../10/">10</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../13/">13</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
        
          
          <a href="../../archive/2025/" class="md-footer__link md-footer__link--next" aria-label="下一页: 2025">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                2025
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../js/tex-mml-chtml.js"></script>
      
        <script src="../../../js/mermaid.min.js"></script>
      
    
  </body>
</html>