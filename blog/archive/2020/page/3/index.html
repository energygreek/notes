
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://energygreek.github.io/notes/blog/archive/2020/page/3/">
      
      
        <link rel="prev" href="../../../2021/">
      
      
        <link rel="next" href="../../../2019/">
      
      
        
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>2020 - Some Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2020" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="Some Notes" class="md-header__button md-logo" aria-label="Some Notes" data-md-component="logo">
      
  <img src="../../../../../assets/bird.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Some Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2020
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="gray" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tags/" class="md-tabs__link">
        
  
  
    
  
  Tag

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Some Notes" class="md-nav__button md-logo" aria-label="Some Notes" data-md-component="logo">
      
  <img src="../../../../../assets/bird.png" alt="logo">

    </a>
    Some Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        linux 添加打印机
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      
        oauth2 认证说明
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用正则来校验输入合法性
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        主要收集一些常见缺陷和加固方法
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      
        C++ 小技巧
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        gdb调试容器内的进程
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git" class="md-nav__link">
    <span class="md-ellipsis">
      
        Git的重要操作
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcc" class="md-nav__link">
    <span class="md-ellipsis">
      
        gcc 会优化很多内存相关的调用
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tag
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        linux 添加打印机
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      
        oauth2 认证说明
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用正则来校验输入合法性
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        主要收集一些常见缺陷和加固方法
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    <span class="md-ellipsis">
      
        C++ 小技巧
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        gdb调试容器内的进程
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git" class="md-nav__link">
    <span class="md-ellipsis">
      
        Git的重要操作
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcc" class="md-nav__link">
    <span class="md-ellipsis">
      
        gcc 会优化很多内存相关的调用
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2020">2020<a class="headerlink" href="#2020" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-24 00:00:00+00:00">2020年7月24日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 2 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="linux"><a class="toclink" href="../../../../add-printer-in-linux/">linux 添加打印机</a></h2>
<p>记一次arch 上添加打印机的过程， 公司有一个Ricoh c5503 的打印机，ip <code>192.168.4.99</code>
通过nmap这个地址可以发现开了不少端口</p>
<div class="highlight"><pre><span></span><code>PORT<span class="w">     </span>STATE<span class="w"> </span>SERVICE
<span class="m">21</span>/tcp<span class="w">   </span>open<span class="w">  </span>ftp
<span class="m">23</span>/tcp<span class="w">   </span>open<span class="w">  </span>telnet
<span class="m">80</span>/tcp<span class="w">   </span>open<span class="w">  </span>http
<span class="m">139</span>/tcp<span class="w">  </span>open<span class="w">  </span>netbios-ssn
<span class="m">514</span>/tcp<span class="w">  </span>open<span class="w">  </span>shell
<span class="m">515</span>/tcp<span class="w">  </span>open<span class="w">  </span>printer
<span class="m">631</span>/tcp<span class="w">  </span>open<span class="w">  </span>ipp
<span class="m">7443</span>/tcp<span class="w"> </span>open<span class="w">  </span>oracleas-https
<span class="m">8080</span>/tcp<span class="w"> </span>open<span class="w">  </span>http-proxy
<span class="m">9100</span>/tcp<span class="w"> </span>open<span class="w">  </span>jetdirect
</code></pre></div>
<h3 id="avahi-daemon"><a class="toclink" href="../../../../add-printer-in-linux/#avahi-daemon">启动avahi-daemon 服务</a></h3>
<p>这个服务提供mDNS功能， 可以发现局域网内的主机提供的服务，例如打印服务，ssh。 各个主机通过<code>224.0.0.251</code> 地址多播自己提供的服务<br />
主机也可以配置自己想广告的服务，这是用户可选的。 具体看wiki </p>
<p>通过执行一下命令可以看到打印服务
<div class="highlight"><pre><span></span><code> avahi-browse --all --ignore-local --resolve --terminate 
</code></pre></div></p>
<p>找到有用的信息如下:
<div class="highlight"><pre><span></span><code>+    br0 IPv4 RICOH MP C4503 [002673734B1D]                 Web Site             local
=    br0 IPv4 RICOH MP C4503 [002673734B1D]                 Web Site             local
   hostname = [RNP002673734B1D.local]
   address = [192.168.4.99]
   port = [80]
   txt = [&quot;path=/&quot;]
</code></pre></div></p>
<h3 id="cupsd"><a class="toclink" href="../../../../add-printer-in-linux/#cupsd">安装cupsd</a></h3>
<p>启动<code>cups-browsed.service</code>服务后， 可以通过网页也配置打印机， 包括分享自己的打印机和添加别人的打印机。 
我这里需要添加打印机服务</p>
<ol>
<li>浏览器输入<code>http://localhost:631/</code> 可以打开网页  </li>
<li>administrator -&gt; add printer 输入root和密码  </li>
<li>有以下选项
<div class="highlight"><pre><span></span><code>Backend Error Handler
Internet Printing Protocol (ipp)
LPD/LPR Host or Printer
Internet Printing Protocol (ipps)
AppSocket/HP JetDirect
Internet Printing Protocol (http)
Internet Printing Protocol (https)
Windows Printer via SAMBA 
</code></pre></div></li>
<li>我这里选择的<code>AppSocket/HP JetDirect</code>， 因为nmap显示是支持<code>jetdirect</code>的。 </li>
<li>输入地址<code>socket://192.168.4.99:9100</code></li>
<li>输入自定义的打印机名称和路径<code>/</code></li>
</ol>
<p>至此，浏览器打印页面就可以看到添加的打印机了</p>
<h3 id="_1"><a class="toclink" href="../../../../add-printer-in-linux/#_1">分享打印机</a></h3>
<p>没有分享的时候，只有本机可以使用，当想要给手机使用时，可以勾选分享。此时CUPS会使用mdns广播打印机服务到主机所处的网段，所以手机也必须在这个网段里。
<img alt="cups_share.png" src="../../../../img/cups_share.png" /></p>
<h3 id="_2"><a class="toclink" href="../../../../add-printer-in-linux/#_2">更新</a></h3>
<p>开始时我走的ipp协议，打印机地址为'ipp://192.168.4.99:631/ipp', 后来连不上打印机  </p>
<p>通过查端口发现有维护人员修改了打印机端口信息, 631和80端口都被封了，可能是出于安全考虑<br />
<div class="highlight"><pre><span></span><code>PORT      STATE    SERVICE
21/tcp    open     ftp
23/tcp    open     telnet
80/tcp    filtered http
139/tcp   open     netbios-ssn
514/tcp   open     shell
515/tcp   open     printer
631/tcp   filtered ipp
7443/tcp  open     oracleas-https
8080/tcp  open     http-proxy
9100/tcp  open     jetdirect
65000/tcp open     unknown
</code></pre></div>
631没有开放，参考windows的同事配置，发现他们用的9100端口(9100是走socket协议)，所以需要重新添加打印机<br />
新的网络地址即为'socket://127.0.0.1:9100'</p>
<h3 id="2"><a class="toclink" href="../../../../add-printer-in-linux/#2">更新2</a></h3>
<p>之前是自己搓的桌面环境，需要手动在CUPS的web界面添加打印机。而自从使用了完整桌面GNOME发现非常简单。GNOME自带有打印机配置工具，只需要填入打印机的IP（也许由于不在一个网段），就会自动检测支持的协议并配置好。</p>
<p><img alt="Pasted image 20240410175417.png" src="../../../../img/Pasted%20image%2020240410175417.png" /></p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-23 00:00:00+00:00">2020年7月23日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 3 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="oauth2"><a class="toclink" href="../../../../oauth2-%E8%AE%A4%E8%AF%81%E8%AF%B4%E6%98%8E/">oauth2 认证说明</a></h2>
<p>oauth2 是依赖第三方的认证方式， 例如玩游戏的时候弹出QQ登录，微信登录。
这种游戏运营商并不需要用户注册，而是直接从QQ或者微信那里获取用户的OPENID， 然后游戏游戏运营商存储并通过OPENID来识别用户</p>
<p>而且， 有资质的游戏运营商还可以通过玩家的openid来获取用户的信息， 例如用户的手机号，网名，年龄等信息。
但<code>有资质</code>这个是有QQ和微信来决定的，游戏运营商需要先去腾讯那里注册认证。腾讯愿意给游戏运营商分享多少信息是腾讯说了算。
所以有用户的数据在手， 腾讯稳稳当国内老大</p>
<p>以QQ登录为例，当玩家登录游戏时，游戏运营商先让用户访问QQ的auth2服务器，并带上游戏运营商的id。待QQ认证后会回调运营商注册的回调接口
一般为<code>oauth/callback</code>，并且带上用户的openid。 这样游戏运营商就知道是谁登录了。</p>
<p>如果游戏运营商需要更多用户资料时，例如注册， 运营商可以通过QQ的查询接口，密钥以及用户的openid 去查询。 这样就拉取到了用户的信息。
然后如果资料不全， 再让玩家补充，例如输入身份证号。这应该国家不准腾讯向别人分享的，必须要用户自己输入。。</p>
<h3 id="githuboauth"><a class="toclink" href="../../../../oauth2-%E8%AE%A4%E8%AF%81%E8%AF%B4%E6%98%8E/#githuboauth">使用github的oauth认证</a></h3>
<ol>
<li>
<p>先去github -&gt; developer 创建oauth应用， 输入自己的回调地址。 当用户被github认证后，会调用这个地址</p>
</li>
<li>
<p>在服务端配置，利用一个开源 <code>oauth2_proxy</code>工具, 项目地址：</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>https://github.com/oauth2-proxy/oauth2-proxy
</code></pre></div>
<ol>
<li>配置nginx</li>
</ol>
<h4 id="oauth2_proxy"><a class="toclink" href="../../../../oauth2-%E8%AE%A4%E8%AF%81%E8%AF%B4%E6%98%8E/#oauth2_proxy">配置`oauth2_proxy</a></h4>
<p>之前遇到问题，一直授权不成功， 原因是cookie_secure 配成了true， 即使是https下。原因未知
<div class="highlight"><pre><span></span><code>auth_logging = true
auth_logging_format = &quot;{{.Client}} - {{.Username}} [{{.Timestamp}}] [{{.Status}}] {{.Message}}&quot;
## pass HTTP Basic Auth, X-Forwarded-User and X-Forwarded-Email information to upstream
pass_basic_auth = true
# pass_user_headers = true
## pass the request Host Header to upstream
## when disabled the upstream Host is used as the Host Header
pass_host_header = true
## Email Domains to allow authentication for (this authorizes any email on this domain)
## for more granular authorization use `authenticated_emails_file`
## To authorize any email addresses use &quot;*&quot;
# email_domains = [
#     &quot;yourcompany.com&quot;
# ]
email_domains=&quot;*&quot;
## The OAuth Client ID, Secret
provider=&quot;github&quot;
client_id = &quot;cef54714c84e3b0c2248&quot;
client_secret = &quot;a96d3d94771273b5295202d03c0c2d3ca7f625dc&quot;
## Pass OAuth Access token to upstream via &quot;X-Forwarded-Access-Token&quot;
pass_access_token = false
## Authenticated Email Addresses File (one email per line)
# authenticated_emails_file = &quot;&quot;
## Htpasswd File (optional)
## Additionally authenticate against a htpasswd file. Entries must be created with &quot;htpasswd -s&quot; for SHA encryption
## enabling exposes a username/login signin form
# htpasswd_file = &quot;&quot;
## Templates
## optional directory with custom sign_in.html and error.html
# custom_templates_dir = &quot;&quot;
## skip SSL checking for HTTPS requests
# ssl_insecure_skip_verify = false
## Cookie Settings
## Name     - the cookie name
## Secret   - the seed string for secure cookies; should be 16, 24, or 32 bytes
##            for use with an AES cipher when cookie_refresh or pass_access_token
##            is set
## Domain   - (optional) cookie domain to force cookies to (ie: .yourcompany.com)
## Expire   - (duration) expire timeframe for cookie
## Refresh  - (duration) refresh the cookie when duration has elapsed after cookie was initially set.
##            Should be less than cookie_expire; set to 0 to disable.
##            On refresh, OAuth token is re-validated.
##            (ie: 1h means tokens are refreshed on request 1hr+ after it was set)
## Secure   - secure cookies are only sent by the browser of a HTTPS connection (recommended)
## HttpOnly - httponly cookies are not readable by javascript (recommended)
# cookie_name = &quot;_oauth2_proxy&quot;
cookie_secret = &quot;beautyfly&quot;
cookie_domains = &quot;beautyflying.cn&quot;
cookie_expire = &quot;168h&quot;
# cookie_refresh = &quot;&quot;
cookie_secure = false
# cookie_httponly = true
</code></pre></div></p>
<p>可以将oauth2 配置成服务</p>
<div class="highlight"><pre><span></span><code>[Unit]
Description = OAuth2 proxy for www blog

[Service]
Type=simple
ExecStart=/usr/bin/oauth2_proxy -config /etc/oauth2-proxy.cfg
[Install]
WantedBy=multi-user.target
</code></pre></div>
<h3 id="nginx"><a class="toclink" href="../../../../oauth2-%E8%AE%A4%E8%AF%81%E8%AF%B4%E6%98%8E/#nginx">nginx 配置</a></h3>
<div class="highlight"><pre><span></span><code>    location /oauth2/ {
            proxy_pass       http://127.0.0.1:4180;
            proxy_set_header Host                    $host;
            proxy_set_header X-Real-IP               $remote_addr;
            proxy_set_header X-Scheme                $scheme;
            proxy_set_header X-Auth-Request-Redirect $request_uri;
        # or, if you are handling multiple domains:
        # proxy_set_header X-Auth-Request-Redirect $scheme://$host$request_uri;
    }

    location = /oauth2/auth {
    proxy_pass       http://127.0.0.1:4180;
    proxy_set_header Host             $host;
    proxy_set_header X-Real-IP        $remote_addr;
    proxy_set_header X-Scheme         $scheme;
    # nginx auth_request includes headers but not body
    proxy_set_header Content-Length   &quot;&quot;;
    proxy_pass_request_body           off;
    }

    location / {

    auth_request /oauth2/auth;
    error_page 401 = /oauth2/sign_in;

    # pass information via X-User and X-Email headers to backend,
    # requires running with --set-xauthrequest flag
    auth_request_set $user   $upstream_http_x_auth_request_user;
    auth_request_set $email  $upstream_http_x_auth_request_email;
    proxy_set_header X-User  $user;
    proxy_set_header X-Email $email;

    # if you enabled --pass-access-token, this will pass the token to the backend
    auth_request_set $token  $upstream_http_x_auth_request_access_token;
    proxy_set_header X-Access-Token $token;

    # if you enabled --cookie-refresh, this is needed for it to work with auth_request
    auth_request_set $auth_cookie $upstream_http_set_cookie;
    add_header Set-Cookie $auth_cookie;

    # When using the --set-authorization-header flag, some provider&#39;s cookies can exceed the 4kb
    # limit and so the OAuth2 Proxy splits these into multiple parts.
    # Nginx normally only copies the first `Set-Cookie` header from the auth_request to the response,
    # so if your cookies are larger than 4kb, you will need to extract additional cookies manually.
    auth_request_set $auth_cookie_name_upstream_1 $upstream_cookie_auth_cookie_name_1;

    # Extract the Cookie attributes from the first Set-Cookie header and append them
    # to the second part ($upstream_cookie_* variables only contain the raw cookie content)
    if ($auth_cookie ~* &quot;(; .*)&quot;) {
        set $auth_cookie_name_0 $auth_cookie;
        set $auth_cookie_name_1 &quot;auth_cookie_name_1=$auth_cookie_name_upstream_1$1&quot;;
    }

    # Send both Set-Cookie headers now if there was a second part
    if ($auth_cookie_name_upstream_1) {
        add_header Set-Cookie $auth_cookie_name_0;
        add_header Set-Cookie $auth_cookie_name_1;
    }

        root   /usr/share/nginx/html/blog;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
</code></pre></div>
<h3 id="baidu-oauth"><a class="toclink" href="../../../../oauth2-%E8%AE%A4%E8%AF%81%E8%AF%B4%E6%98%8E/#baidu-oauth">使用baidu 的oauth 认证</a></h3>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-23 00:00:00+00:00">2020年7月23日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="_1"><a class="toclink" href="../../../../%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E6%9D%A5%E6%A0%A1%E9%AA%8C%E8%BE%93%E5%85%A5%E5%90%88%E6%B3%95%E6%80%A7/">使用正则来校验输入合法性</a></h2>
<p>软件加固里面经常使用的办法就是校验用户输入，例如要求名词需要是大小写或_开头， 支持包含大小写 ，中划线 -，下划线_以及点.</p>
<p>那么相应的正则表到式为<code>^[a-zA-Z_][-a-zA-Z1-9_.]*$</code>，校验方法为</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s1">&#39;^[a-zA-Z_][-a-zA-Z1-9_.]*$&#39;</span>
<span class="nb">test</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;no&quot;</span>
</code></pre></div>
<p>用python实现</p>
<div class="highlight"><pre><span></span><code>Type<span class="w"> </span><span class="s2">&quot;help&quot;</span>,<span class="w"> </span><span class="s2">&quot;copyright&quot;</span>,<span class="w"> </span><span class="s2">&quot;credits&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;license&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>information.
&gt;&gt;&gt;<span class="w"> </span>import<span class="w"> </span>re
&gt;&gt;&gt;<span class="w"> </span>print<span class="o">(</span>re.match<span class="o">(</span><span class="s1">&#39;^[a-zA-Z_][a-zA-Z0-9\-_.]*$&#39;</span>,<span class="w"> </span><span class="s1">&#39;_abcdedf.&#39;</span>,<span class="w"> </span><span class="nv">flags</span><span class="o">=</span><span class="m">0</span><span class="o">))</span>
&lt;re.Match<span class="w"> </span>object<span class="p">;</span><span class="w"> </span><span class="nv">span</span><span class="o">=(</span><span class="m">0</span>,<span class="w"> </span><span class="m">9</span><span class="o">)</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=</span><span class="s1">&#39;_abcdedf.&#39;</span>&gt;
&gt;&gt;&gt;<span class="w"> </span>print<span class="o">(</span>re.match<span class="o">(</span><span class="s1">&#39;^[a-zA-Z_][a-zA-Z0-9\-_.]*$&#39;</span>,<span class="w"> </span><span class="s1">&#39;._abcdedf.&#39;</span>,<span class="w"> </span><span class="nv">flags</span><span class="o">=</span><span class="m">0</span><span class="o">))</span>
None
</code></pre></div>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-23 00:00:00+00:00">2020年7月23日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="_1"><a class="toclink" href="../../../../%E4%B8%BB%E8%A6%81%E6%94%B6%E9%9B%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%BC%BA%E9%99%B7%E5%92%8C%E5%8A%A0%E5%9B%BA%E6%96%B9%E6%B3%95/">主要收集一些常见缺陷和加固方法</a></h2>
<h3 id="javascript"><a class="toclink" href="../../../../%E4%B8%BB%E8%A6%81%E6%94%B6%E9%9B%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%BC%BA%E9%99%B7%E5%92%8C%E5%8A%A0%E5%9B%BA%E6%96%B9%E6%B3%95/#javascript">javascript</a></h3>
<ol>
<li>xss漏洞：
在输入框注入代码如 <code>&lt;script&gt; alert(1)&lt;/script&gt;</code> <br />
解决办法是校验输入</li>
</ol>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-20 00:00:00+00:00">2020年7月20日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="c"><a class="toclink" href="../../../../c-%E5%B0%8F%E6%8A%80%E5%B7%A7/">C++ 小技巧</a></h2>
<h3 id="lambda-const"><a class="toclink" href="../../../../c-%E5%B0%8F%E6%8A%80%E5%B7%A7/#lambda-const">使用lambda 定义一个可变的const</a></h3>
<p>因为const 不能改变的，只有在程序运行的时候初始化。 而通过lamda，可以通过获取命令行输入来改变值</p>
<div class="highlight"><pre><span></span><code>const int x = []() -&gt; int {
        int t;
        std::cin &gt;&gt; t;
        return t;
}();
</code></pre></div>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-20 00:00:00+00:00">2020年7月20日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="gdb"><a class="toclink" href="../../../../gdb%E8%B0%83%E8%AF%95%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%BF%9B%E7%A8%8B/">gdb调试容器内的进程</a></h2>
<p>先来个<a href="https://undo.io/resources/cppcon-2015-greg-law-give-me-15-minutes-ill-change/">gdb手册链接</a><br />
这里记录一下自己常用的技巧</p>
<h3 id="debug"><a class="toclink" href="../../../../gdb%E8%B0%83%E8%AF%95%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%BF%9B%E7%A8%8B/#debug">恢复debug符号</a></h3>
<p>通常上线的程序要strip符号表来减少<strong>内存占用</strong>和硬盘占用，会执行以下命令
<div class="highlight"><pre><span></span><code><span class="c1">## 1. 只保留debug表的内容（可选），为以后调试用，生产时不用</span>
objcopy<span class="w"> </span>--only-keep-debug<span class="w"> </span>foo<span class="w"> </span>foo.dbg

<span class="c1">## 2. 将foo的debug表删除，不要任何调试信息，用于生产使用</span>
objcopy<span class="w"> </span>--strip-debug<span class="w">  </span>foo<span class="w"> </span>
</code></pre></div></p>
<p>如果生产出问题了，就需要恢复debug信息，add-gnu-debuglink参数可以是foo.dbg, 也可以就是strip之前的foo文件<br />
所以第一步是可选的 </p>
<div class="highlight"><pre><span></span><code>## 3. 恢复debug信息
objcopy --add-gnu-debuglink=foo.dbg foo
</code></pre></div>
<p>但其实第三步也是可选的，只要把foo.dbg放到foo相同位置时，gdb就可以读取到debug信息</p>
<h3 id="gdbinit"><a class="toclink" href="../../../../gdb%E8%B0%83%E8%AF%95%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%BF%9B%E7%A8%8B/#gdbinit">使用.gdbinit</a></h3>
<p>.gdbinit 文件是类似.bash_profile的文件，一般在home目录或者项目根目录, gdb 自动读取  <br />
也可以手动读取其他位置的, 在gdb执行<code>source /somedir/.gdbinit</code></p>
<p>通常可以在这个文件里定义一些设置例如<code>set pagination off</code> 关闭输出分页, 就不用每次交互确定<br />
还可以定义命令 如pvector可以打印vector内的所有成员, 非常比较方便</p>
<h3 id="gdb_1"><a class="toclink" href="../../../../gdb%E8%B0%83%E8%AF%95%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%BF%9B%E7%A8%8B/#gdb_1">gdb 调试容器内的进程</a></h3>
<p>因为容器内运行的程序都是strip了debug符号的，所以之前调试都是先将debug文件复制到容器对应位置，然后将源码也映射到容器内，而且还要安装gdb和重新开启priveledge模式， 非常繁琐。 <br />
所以尝试如下操作：<br />
1. 能不能单独一个容器安装gdb和符号和代码文件， 跨容器去调试另一个容器的进程呢？ 
2. 能不能在宿主机上直接调试容器进程呢？   </p>
<p>经过一番搜索，没有第一种方案的实践办法，但第二种方案亲测可行！</p>
<h3 id="_1"><a class="toclink" href="../../../../gdb%E8%B0%83%E8%AF%95%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%BF%9B%E7%A8%8B/#_1">步骤</a></h3>
<ol>
<li>先启动容器，一般业务主进程的pid为1  </li>
<li>在容器外面执行<code>ps aux | grep xxx</code>，因为在很多情况是多个容器跑同一个程序，所以<code>ps aux</code> 通过参数名来确定进程的pid， 当然最好的方式是通过进程namespace了 </li>
<li>使用sudo gdb -p pid， 提示缺少<code>Missing separate debuginfo for target</code></li>
<li>将debug符号文件复制到容器对应容器的目录</li>
<li>再次attach，提示缺少源文件<code>/builds/project/src/aaa.cpp</code>，这是cmake编译时的目录，需要替换</li>
<li>在gdb里执行命令 set substitute-path /builds/ /home/my-home/  # from -&gt; to</li>
<li>然后使用l可以查看对应的源代码了</li>
</ol>
<h3 id="_2"><a class="toclink" href="../../../../gdb%E8%B0%83%E8%AF%95%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E8%BF%9B%E7%A8%8B/#_2">总结</a></h3>
<p>可以直接在宿主机上运行gdb来调试容器进程，并替换代码路径为宿主机的目录。 </p>
<p>ps: gdb 启动时默认会读取~/.gdbinit 文件, 但是gdb会提示, 这是由于调试docker需要sudo权限，而我的gdbinit在非root目录</p>
<div class="highlight"><pre><span></span><code>warning: File &quot;/home/h/.gdbinit&quot; auto-loading has been declined by your `auto-load safe-path&#39; set to &quot;$debugdir:$datadir/auto-load&quot;.                                                        
To enable execution of this file add                                                                                                                                                          
        add-auto-load-safe-path /home/h/.gdbinit                                                                                                                                            
line to your configuration file &quot;/root/.gdbinit&quot;.                                                                                                                                             
To completely disable this security protection add                                                                                                                                            
        set auto-load safe-path /                                                                                                                                                             
line to your configuration file &quot;/root/.gdbinit&quot;.                                                                                                                                             
</code></pre></div>
<p>也就是需要手动执行<code>set auto-load safe-path /</code> 或者将 <code>add-auto-load-safe-path /home/h/.gdbinit</code>写入/root/.gdbinit </p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-20 00:00:00+00:00">2020年7月20日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="git"><a class="toclink" href="../../../../git%E7%9A%84%E9%87%8D%E8%A6%81%E6%93%8D%E4%BD%9C/">Git的重要操作</a></h2>
<h2 id="git_1"><a class="toclink" href="../../../../git%E7%9A%84%E9%87%8D%E8%A6%81%E6%93%8D%E4%BD%9C/#git_1">Git登录信息</a></h2>
<p>在临时环境下拉代码， 如果重新生成密钥再添加到托管平台比较麻烦，要么拷贝自己的私钥过来，更加不安全。
这时候临时用密码登录最适合了， 但是每个pull fetch操作都要登录，这很烦躁，所以下面有2个方法解决</p>
<h3 id="_1"><a class="toclink" href="../../../../git%E7%9A%84%E9%87%8D%E8%A6%81%E6%93%8D%E4%BD%9C/#_1">设置密码暂存</a></h3>
<p>指类似sudo命令一样， 校验成功之后一段时间，不需要输入密码
<div class="highlight"><pre><span></span><code>git config --global   credential.helper &#39;cache --timeout 900&#39;
</code></pre></div>
我们都知道Git 的配置分3种级别 local system global， 这里推荐global。
因为只设置local，在有submodule的情况下，同样会提示输入密码。</p>
<h3 id="_2"><a class="toclink" href="../../../../git%E7%9A%84%E9%87%8D%E8%A6%81%E6%93%8D%E4%BD%9C/#_2">设置密码永存</a></h3>
<p>不推荐 
<div class="highlight"><pre><span></span><code>git config --global   credential.helper store
</code></pre></div></p>
<h3 id="git_2"><a class="toclink" href="../../../../git%E7%9A%84%E9%87%8D%E8%A6%81%E6%93%8D%E4%BD%9C/#git_2">git为不同项目配置不同的用户名和邮箱</a></h3>
<p>电脑中同时有个人项目和公司项目时，有时候会导致commit 消息里面的邮件搞串了。可以通过git配置不同目录下的项目使用不同的信息。<a href="https://garrit.xyz/posts/2023-10-13-organizing-multiple-git-identities">参考</a></p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-01-10 00:00:00+00:00">2020年1月10日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="gcc"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/">gcc 会优化很多内存相关的调用</a></h2>
<p>他们通常在'string.h'里，比如memcpy, 当编译器通过上下文能推断出传入参数类型，libc的mempcy就会替换为gcc的memcpy, 这可能导致问题</p>
<h3 id="_1"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/#_1">举例</a></h3>
<p>知乎评论的，release版本的memset被替换, 导致跟debug版本不同行为bug
<div class="highlight"><pre><span></span><code>https://www.zhihu.com/question/435258463/answer/1969561682
</code></pre></div></p>
<h3 id="_2"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/#_2">内存地址对齐</a></h3>
<p>如果内存地址对齐的，那么'取值地址被取值长度求模为0'，例如<code>int i</code>, 则要求<code>(void*)&amp;i % sizeof(int) == 0</code>  </p>
<h3 id="_3"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/#_3">原因</a></h3>
<p>当同时定义多个变量时，不考虑编译器优化，则他们在内存的位置相邻。按照不同的对齐长度，有不同的占用大小<br />
这里以结构体举例</p>
<p><div class="highlight"><pre><span></span><code>struct bar{
    int interger;
        char charactor;
        long long longlong;
};
</code></pre></div>
使用<code>#pragma pack(4)</code> 设置按4字节对齐，默认也是4字节，那么<code>sizeof(struct abc) == 16</code>
使用gdb打印内存地址，可见地址都对齐的: '0x7fffffffe430&amp;4==0' '0x7fffffffe438%8==0'
<div class="highlight"><pre><span></span><code>(gdb) p sizeof(struct abc)
$5 = 16
(gdb) p &amp;a.interger 
$1 = (int *) 0x7fffffffe430
(gdb) p &amp;a.charactor 
$2 = 0x7fffffffe434 &quot;\232\177&quot;
(gdb) p &amp;a.longlong 
$3 = (long long *) 0x7fffffffe438
(gdb) p &amp;a
$4 = (abc *) 0x7fffffffe430
</code></pre></div></p>
<p>顺便提一下，指针指向的是内存段的低地址，所以有个面试题是判断系统是大端小端的方法如下<br />
通过如下强转int为char, 如果<code>c==0x12</code>则为大端，否则为小端系统
<div class="highlight"><pre><span></span><code>int i=0x12345678;
char c=(char)i;
</code></pre></div></p>
<p>使用<code>#pragma pack(1)</code> 设置为按1字节对齐，则上面的结构体大小为'13'，显然更省内存了<br />
但通过取地址会发现地址未对齐, 求模不为0。 但我自己使用gcc测试地址依旧对齐的，原因是编译器会进行自然 对齐</p>
<h3 id="_4"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/#_4">自然对齐</a></h3>
<p>上面的<code>#pragma pack(1)</code>虽然使得longlong的地址对于bar来说偏移了5字节，但编译器始终能调整bar的起始地址使得longlong的地址对齐
<div class="highlight"><pre><span></span><code>595fac88 
c3c5a2d8
105d3ab8
</code></pre></div></p>
<h3 id="_5"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/#_5">不对齐的坏处</a></h3>
<p>虽然上面说了编译器能自然对齐，但还是会真的出现不对齐访问。由于对内存的访问涉及到具体硬件的实现，所以一般会有几种影响
1. 硬件平台支持非对齐访问，但性能有损耗
2. 抛出异常给cpu,由cpu来校准，性能有更大损耗
3. 平台不支持，但也不抛异常，获取的是错误的值，导致难定位的异常</p>
<h3 id="_6"><a class="toclink" href="../../../../gcc-%E4%BC%9A%E4%BC%98%E5%8C%96%E5%BE%88%E5%A4%9A%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E8%B0%83%E7%94%A8/#_6">引用</a></h3>
<p>https://www.kernel.org/doc/html/latest/core-api/unaligned-memory-access.html</p>
    
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <a class="md-pagination__link" href="../2/">2</a> <span class="md-pagination__current">3</span>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../2021/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 2021">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                2021
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../2019/" class="md-footer__link md-footer__link--next" aria-label="下一页: 2019">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                2019
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../../js/tex-mml-chtml.js"></script>
      
        <script src="../../../../../js/mermaid.min.js"></script>
      
    
  </body>
</html>