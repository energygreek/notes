
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://energygreek.github.io/notes/blog/archive/2023/">
      
      
        <link rel="prev" href="../2024/">
      
      
        <link rel="next" href="../2022/">
      
      
        
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>2023 - Some Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2023" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Some Notes" class="md-header__button md-logo" aria-label="Some Notes" data-md-component="logo">
      
  <img src="../../../assets/bird.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Some Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2023
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="gray" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tags/" class="md-tabs__link">
        
  
  
    
  
  Tag

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Some Notes" class="md-nav__button md-logo" aria-label="Some Notes" data-md-component="logo">
      
  <img src="../../../assets/bird.png" alt="logo">

    </a>
    Some Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#iwdap" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用iwd创建ap热点
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-acronyms" class="md-nav__link">
    <span class="md-ellipsis">
      
        database acronyms
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udp" class="md-nav__link">
    <span class="md-ellipsis">
      
        udp 查看统计的方法
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux创建热点
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wifi" class="md-nav__link">
    <span class="md-ellipsis">
      
        随身wifi工具刷机
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pve" class="md-nav__link">
    <span class="md-ellipsis">
      
        pve入门
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ibus-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        ibus-setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libavcodec" class="md-nav__link">
    <span class="md-ellipsis">
      
        libavcodec使用
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-network" class="md-nav__link">
    <span class="md-ellipsis">
      
        docker network
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux下的邮件配置
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tag
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#iwdap" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用iwd创建ap热点
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-acronyms" class="md-nav__link">
    <span class="md-ellipsis">
      
        database acronyms
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udp" class="md-nav__link">
    <span class="md-ellipsis">
      
        udp 查看统计的方法
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux创建热点
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wifi" class="md-nav__link">
    <span class="md-ellipsis">
      
        随身wifi工具刷机
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pve" class="md-nav__link">
    <span class="md-ellipsis">
      
        pve入门
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ibus-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        ibus-setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libavcodec" class="md-nav__link">
    <span class="md-ellipsis">
      
        libavcodec使用
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-network" class="md-nav__link">
    <span class="md-ellipsis">
      
        docker network
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux下的邮件配置
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2023">2023<a class="headerlink" href="#2023" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-11-08 00:00:00+00:00">2023年11月8日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="iwdap"><a class="toclink" href="../../%E4%BD%BF%E7%94%A8iwd%E5%88%9B%E5%BB%BAap%E7%83%AD%E7%82%B9/">使用iwd创建ap热点</a></h2>
<p>windows中有很多软件能创建热点，现在Linux也可以创建热点了，下面记录方法</p>
<h3 id="ap"><a class="toclink" href="../../%E4%BD%BF%E7%94%A8iwd%E5%88%9B%E5%BB%BAap%E7%83%AD%E7%82%B9/#ap">确认网卡支持AP</a></h3>
<p>使用<code>iw list</code>查看wifi网卡信息，如果在Supported interface modes能找到AP，说明网卡支持创建热点。</p>
<h3 id="iwd"><a class="toclink" href="../../%E4%BD%BF%E7%94%A8iwd%E5%88%9B%E5%BB%BAap%E7%83%AD%E7%82%B9/#iwd">使用iwd</a></h3>
<p>之前研究的wifi棒子，都是用wpa_supplicant来创建热点。而在我自己的电脑里一直使用的intel的iwd。
1. 先修改iwd的配置文件/etc/iwd/main.conf
<div class="highlight"><pre><span></span><code>[General]
EnableNetworkConfiguration=true
</code></pre></div>
2. 在iwd保存密码的目录创建ap子目录
<div class="highlight"><pre><span></span><code>mkdir -p /var/lib/iwd/ap/
</code></pre></div>
3. 在ap目录创建配置文件名字如main.ap，内容如下
<div class="highlight"><pre><span></span><code>[Security]
Passphrase=password123

[IPv4]
Address=192.168.250.1
Gateway=192.168.250.1
Netmask=255.255.255.0
DNSList=8.8.8.8
</code></pre></div>
4. 执行iwctl命令进入到iwd交互模式
<div class="highlight"><pre><span></span><code>[iwd]# device wlan0 set-property Mode ap
[iwd]# ap wlan0 start-profile main
[iwd]# 
</code></pre></div>
5. 启动内核转发
<div class="highlight"><pre><span></span><code># sudo sysctl -w net.ipv4.ip_forward=1
net.ipv4.ip_forward = 1
# sudo iptables -t nat -A POSTROUTING -s 192.168.250.0/24 -j MASQUERADE
</code></pre></div></p>
<p>我做完上面的步骤后，发现wifi连接不上，也有报错。然后重启了iwd服务，发现没有了main这个热点，所以这个热点不会自动启动。在执行4步骤后，就能正常连接wifi了。</p>
<h3 id="ad-hoc-ap"><a class="toclink" href="../../%E4%BD%BF%E7%94%A8iwd%E5%88%9B%E5%BB%BAap%E7%83%AD%E7%82%B9/#ad-hoc-ap">ad-hoc 和 ap 的区别</a></h3>
<p>ad-hoc是去中心化的组网方式，各连接节点可以直接通讯，而有些终端可能不支持。AP模式又叫做infrustructure Mode，就是类似传统的路由器模式，所以兼容性更好。</p>
<h3 id="_1"><a class="toclink" href="../../%E4%BD%BF%E7%94%A8iwd%E5%88%9B%E5%BB%BAap%E7%83%AD%E7%82%B9/#_1">使用总结</a></h3>
<p>这个ap不稳定，长时间使用后没有网络， 需要重建ap， 不推荐。最终还是装了个便宜路由器MI-mini。老旧路由器的性能差，当路由（NAT）的丢包率太高， 但当桥接入口（交换机）正常。</p>
<h3 id="_2"><a class="toclink" href="../../%E4%BD%BF%E7%94%A8iwd%E5%88%9B%E5%BB%BAap%E7%83%AD%E7%82%B9/#_2">参考</a></h3>
<p>https://iwd.wiki.kernel.org/ap_mode</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-11-07 00:00:00+00:00">2023年11月7日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="database-acronyms"><a class="toclink" href="../../database-acronyms/">database acronyms</a></h2>
<p>常常被几个缩写搞晕，今天有空好好查了下。</p>
<h3 id="crud"><a class="toclink" href="../../database-acronyms/#crud">CRUD 增删改查</a></h3>
<p>web后端代名词，CREATE READ UPDATE DELETE</p>
<h3 id="acid"><a class="toclink" href="../../database-acronyms/#acid">ACID 事物操作的四个特性</a></h3>
<p>Atomic 原子性，一次事物包含多个操作，这些操作要么都成功，要么都失败。
Consistency 一致性
Isolation 隔离性，多个事物之间按优先级并发，互不影响
Durability 持久性，数据储持久化，存储在磁盘上而非内存中</p>
<h3 id="cap"><a class="toclink" href="../../database-acronyms/#cap">CAP 分布式系统的不可能三角的定理</a></h3>
<p>Consistency 一致性，保证所有节点的数据状态都一致
Availbility 可用性，保证能对外服务
Partition tolerance 分区容忍性，可以接受系统出现分区，俗称脑裂。</p>
<p>CAP是被证明的定理，不可能三角表示同时最多只能保证两个，而不能保证三个。三种情况解释如下：
1. 多节点的系统不能保证没有故障，就需要系统能接受系统出现分区（脑裂）。当出现分区时，需要从C一致性和A可用性中二选一，当选择一致性时，就放弃可用性。因为网络有分区无法保证查询信息是一致的，所以请求将返回失败。
2. 当选择可用性时，系统将每次都尝试返回最新的结果，即使由于分区导致数据不一定是最新的。
3. 而当没有出现分区时，可以同时保证一致性和可用性。</p>
<p>简而言之1保证了C+P，2保证了A+P，3保证了C+A</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-11-03 00:00:00+00:00">2023年11月3日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="udp"><a class="toclink" href="../../udp-%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E7%9A%84%E6%96%B9%E6%B3%95/">udp 查看统计的方法</a></h2>
<ul>
<li>/proc/net/snmp</li>
<li>/proc/net/udp</li>
</ul>
<p>除此之外，还有通常使用netstat/ss 来查看发送队列和接收队列的缓冲区占用。</p>
<h4 id="procnetsnmp"><a class="toclink" href="../../udp-%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E7%9A%84%E6%96%B9%E6%B3%95/#procnetsnmp">/proc/net/snmp</a></h4>
<p><div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/proc/net/snmp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Udp<span class="se">\:</span>
</code></pre></div>
输出格式
Udp: InDatagrams NoPorts InErrors OutDatagrams RcvbufErrors SndbufErrors</p>
<ul>
<li>InDatagrams recvmsg调用时，值会增加。</li>
<li>NoPorts 发送到没有监听的端口，值会增加</li>
<li>InErrors 没有内存，或者checksum失败</li>
<li>OutDatagrams 成功发送到IP层，注意这不代表包成功发送出去了，因为在IP层可能有错误，比如路由错误，会导致IP层的OutNoRoutes值增加</li>
</ul>
<h4 id="procnetudp"><a class="toclink" href="../../udp-%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E7%9A%84%E6%96%B9%E6%B3%95/#procnetudp">/proc/net/udp</a></h4>
<p><div class="highlight"><pre><span></span><code>cat /proc/net/udp
</code></pre></div>
输出格式
  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode ref pointer drops</p>
<ul>
<li>sl hash slot for the socket</li>
<li>local_address 16进制的ip.端口</li>
<li>st socket state</li>
<li>tx_queue 发送队列的内存大小</li>
<li>rx_queue 接收队列的内存大小</li>
<li>inode socket对应的inode，可以判断哪个进程打开了这个socket</li>
<li>drops 只记录了接收方向被丢掉的包，不包括发送方向丢掉的包。</li>
</ul>
<h3 id="_1"><a class="toclink" href="../../udp-%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E7%9A%84%E6%96%B9%E6%B3%95/#_1">参考</a></h3>
<p>https://blog.packagecloud.io/monitoring-tuning-linux-networking-stack-sending-data/#monitoring-udp-protocol-layer-statistics</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-09-19 00:00:00+00:00">2023年9月19日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="linux"><a class="toclink" href="../../linux%E5%88%9B%E5%BB%BA%E7%83%AD%E7%82%B9/">Linux创建热点</a></h2>
<p>iptables 用来配置转发数据包规则的工具，Linux的防火墙配置就是利用的iptables。普通的路由器也是使用的iptables来实现NAT地址转换。</p>
<h3 id="iptables"><a class="toclink" href="../../linux%E5%88%9B%E5%BB%BA%E7%83%AD%E7%82%B9/#iptables">使用iptables转发流量</a></h3>
<p>路由器使用的局域网ip，例如可使用的局域网有3类
* A类地址：10.0.0.0 - 10.255.255.255  ==&gt; 10.0.0.0/8
* B类地址：172.16.0.0 - 172.31.255.255 ==&gt; 
* C类地址：192.168.0.0 -192.168.255.255 ==&gt; 192.168.0.0/16</p>
<h4 id="lan"><a class="toclink" href="../../linux%E5%88%9B%E5%BB%BA%E7%83%AD%E7%82%B9/#lan">公网访问路由LAN，常见防火墙后的服务器</a></h4>
<p>假设公网客户（8.8.8.8）访问路由器下的服务（192.168.0.2）。请求先到达路由的公网地址假设1.1.1.1, 此时的ip层源地址和目的地址分别为（8.8.8.8/1.1.1.1)， 然后路由器需要将目的地址改写为192.168.0.2，此时ip包的地址为（8.8.8.8/192.168.0.2)，这需要的iptable规则为</p>
<p><div class="highlight"><pre><span></span><code>iptables -t nat -A PREROUTING -d 1.1.1.1 -j DNAT --to-destination 192.168.0.2
</code></pre></div>
ip包就能正常到达192.168.0.2，处理完成之后，ip包变成(192.168.0.2/8.8.8.8)，这是可能有几种情况：
* 没有路由规则能匹配8.8.8.8，则会被丢弃。
* 一般会发送到默认网关，然后由网关发送正确发送到8.8.8.8，但8.8.8.8客户不认识源地址192.168.0.2，所以包会被丢弃
* 直接在第一个路由上被丢弃，因为192.168.0.2是一个私有地址，不能被转发。</p>
<p>所以需要另外一条iptables规则，将192.168.0.2发出的ip包改成（1.1.1.1/8.8.8.8）</p>
<div class="highlight"><pre><span></span><code>iptables -t nat -A POSTROUTING -s 192.168.0.2 -j SNAT --to-source 1.1.1.1
</code></pre></div>
<h3 id="reference"><a class="toclink" href="../../linux%E5%88%9B%E5%BB%BA%E7%83%AD%E7%82%B9/#reference">Reference</a></h3>
<p>https://serverfault.com/questions/627608/redirect-all-incoming-traffic-from-a-secondary-public-ip-to-an-internal-ip-addre</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-09-08 00:00:00+00:00">2023年9月8日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 3 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="wifi"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/">随身wifi工具刷机</a></h2>
<p>本文记录了淘宝卖的随身wifi刷机成Debian，还能收发短信。还有救砖的艰辛过程，不过结局美满。</p>
<h3 id="_1"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_1">依赖</a></h3>
<ul>
<li>edl备份恢复工具，https://github.com/bkerler/edl, 下载源代码后执行<code>git submodule update --init --recursive</code>和 <code>pip install -r requirements.txt</code></li>
<li>openstick编译好的debian https://github.com/OpenStick/OpenStick。 在release页面下载 base.zip, debian.zip, firmware-ufi001c.zip，boot-ufi001c.img</li>
<li>apt 安装 adb fastboot</li>
</ul>
<h3 id="_2"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_2">切卡</a></h3>
<p>刚接触时看网上的都是在后台页面切卡，但是刷机了没有后台页面如何切卡呢？ 为了切卡又重刷安卓，导致变砖了。参考网上资料发现，Debian下可以直接切。
<div class="highlight"><pre><span></span><code>debian默认卡槽位1:

echo 1 &gt; /sys/class/leds/sim:sel/brightness
echo 0 &gt; /sys/class/leds/sim:en/brightness
echo 0 &gt; /sys/class/leds/sim:sel2/brightness
echo 0 &gt; /sys/class/leds/sim:en2/brightnessR
modprobe -r qcom-q6v5-mss
modprobe qcom-q6v5-mss
systemctl restart rmtfs
systemctl restart dbus-org.freedesktop.ModemManager1.service

esim槽位3:

echo 0 &gt; /sys/class/leds/sim:sel/brightness
echo 0 &gt; /sys/class/leds/sim:en/brightness
echo 1 &gt; /sys/class/leds/sim:sel2/brightness
echo 0 &gt; /sys/class/leds/sim:en2/brightness
modprobe -r qcom-q6v5-mss
modprobe qcom-q6v5-mss
systemctl restart rmtfs
systemctl restart dbus-org.freedesktop.ModemManager1.service

其他两个槽位

槽位2:

echo 0 &gt; /sys/class/leds/sim:sel/brightness
echo 1 &gt; /sys/class/leds/sim:en/brightness
echo 0 &gt; /sys/class/leds/sim:sel2/brightness
echo 0 &gt; /sys/class/leds/sim:en2/brightness
modprobe -r qcom-q6v5-mss
modprobe qcom-q6v5-mss
systemctl restart rmtfs
systemctl restart dbus-org.freedesktop.ModemManager1.service

槽位4:
echo 0 &gt; /sys/class/leds/sim:sel/brightness
echo 0 &gt; /sys/class/leds/sim:en/brightness
echo 0 &gt; /sys/class/leds/sim:sel2/brightness
echo 1 &gt; /sys/class/leds/sim:en2/brightness
modprobe -r qcom-q6v5-mss
modprobe qcom-q6v5-mss
systemctl restart rmtfs
systemctl restart dbus-org.freedesktop.ModemManager1.service

有些棒子esim槽位不一样槽位3不行自行试试槽位2 4
</code></pre></div>
https://github.com/OpenStick/OpenStick/issues/49#issuecomment-1568202001</p>
<h3 id="_3"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_3">刷机</a></h3>
<p>先使用edl全量备份，方法在最下面。先刷base包，解压base.zip后执行里面的<code>flash.sh</code>。然后刷debian包，解压debian.zip后执行里面的<code>flash.sh</code>。这时进入系统发现可能出现问题（我也没明显感觉到问题），因为他们是ufi001b的。
所以再刷适配ufi001c的包，解压firmware-ufi001c.zip。
<div class="highlight"><pre><span></span><code>cd firmware-ufi001c
adb push ./* /lib/firmware
adb reboot bootloader
fastboot flash boot boot-ufi001c.img
fastboot reboot
</code></pre></div>
但是在刷ufi001c的包之前我能找到modem网络，刷完就没了，所以有了下面基带恢复的步骤。</p>
<h3 id="_4"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_4">基带</a></h3>
<p>基带文件在随身wifi的modem分区，先用edl备份modem分区。当然下面介绍了edl全量备份，跳过了userdata，估计是root和home目录。</p>
<h4 id="_5"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_5">恢复基带文件</a></h4>
<p>我在安装debian系统时，发现移动网络不可用，于是参考网上说的，将原始基带恢复后正常。 基带文件名为"modem.bin", edl全量备份后在dumps目录下。直接mount该文件，然后将modem.*和mba.mbn取出来，当发现刷机后发现移动网络不能使用时，重新拷回去就能用了。
<div class="highlight"><pre><span></span><code>sudo mount modem.bin /mnt
</code></pre></div>
复制到firmware-ufi001c目录，覆盖之前的文件。
<div class="highlight"><pre><span></span><code>cp /mnt/modem.* .
cp /mnt/mba.mbn .
</code></pre></div></p>
<p>再次拷贝到wifi棒子的/lib/firmware目录, 配合再刷一次适配001C的boot文件。
<div class="highlight"><pre><span></span><code>adb push ./* /lib/firmware
adb reboot bootloader
fastboot flash boot boot-ufi001c.img
fastboot reboot #重启
</code></pre></div></p>
<p>然后就能找到modem网卡了。</p>
<h3 id="modem"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#modem">重启modem</a></h3>
<p>有时重刷了firmware，还是出现没有modem网卡的情况，也就是<code>mmcli -m 0</code>提示找不到modem设备的时候，需要执行下面的命令。或者直接等一会重启ModemManager
<div class="highlight"><pre><span></span><code>systemctl stop ModemManager
qmicli -d /dev/wwan0qmi0 --uim-sim-power-off=1 &amp;&amp; qmicli -d /dev/wwan0qmi0 --uim-sim-power-on=1
systemctl start ModemManager
</code></pre></div></p>
<h3 id="_6"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_6">短信收发和转发邮件</a></h3>
<p>下载两个python文件，地址 https://gitee.com/jiu-xiao/ufi-message。配置smtp.py中的邮箱信息，我使用的QQ邮箱登录，然后转发到另一个邮箱。开始发送不成功，修改后能发送了，内容如下。
<div class="highlight"><pre><span></span><code>#!python3

my_sender=&#39;@qq.com&#39;
my_user=&#39;@hotmail.com&#39;
server_address=&#39;smtp.qq.com&#39;
server_port=465
server_passwd=&#39;&#39; #填写qq邮箱授权码


import smtplib
from email.mime.text import MIMEText
from email.utils import formataddr
import datetime
import time

def mail(text):
    msg=MIMEText(text,&#39;plain&#39;,&#39;utf-8&#39;)
    msg[&#39;From&#39;]=formataddr([&quot;随身Wifi&quot;,my_sender])
    msg[&#39;To&#39;]=formataddr([my_user,my_user])
    msg[&#39;Subject&#39;]=&quot;转发 &quot;+time.strftime(&quot;%H:%%M:%S %m/%d&quot;)

    server=smtplib.SMTP_SSL(server_address,server_port)

    server.login(my_sender,server_passwd)
    server.auth_plain()
    server.sendmail(my_sender,[my_user,],msg.as_string())
    server.quit()
</code></pre></div></p>
<p>然后就能写进crontab自动跑了。</p>
<h3 id="_7"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_7">救砖</a></h3>
<h4 id="edl"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#edl">edl使用</a></h4>
<p>github上的开源工具，可以替代Windows那些高通工具，Miko，星海啥的。是我这Linux用户的福音，并且简单，windows常常失败。
使用edl工具之前要先重启到edl也就是9008模式，使用命令<code>adb reboot edl</code>，不需要按RST键。</p>
<p>备份：推荐第一种方式，第二种方式生成的一个文件刷到另一个设备失败，但是可以刷MiKo导出的单文件。
<div class="highlight"><pre><span></span><code>edl rl dumps --skip=userdata --genxml
or
edl rf flash.bin #单文件
</code></pre></div></p>
<p>恢复:
<div class="highlight"><pre><span></span><code>edl qfil rawprogram0.xml patch0.xml .
</code></pre></div></p>
<h4 id="_8"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_8">恢复分区</a></h4>
<p>刷了debian后，分区会变，这样导致有些分区不存在所以无法刷回去。这里介绍下恢复分区的方法。不过上面的edl恢复应该不需要这个操作。</p>
<p>备份分区
<div class="highlight"><pre><span></span><code>./edl gpt . --genxml
</code></pre></div>
备份后有两个文件，恢复时只用gpt_main0.bin文件，恢复分区命令
<div class="highlight"><pre><span></span><code>./edl w gpt gpt_main0.bin
</code></pre></div>
打印分区来验证下</p>
<div class="highlight"><pre><span></span><code>./edl printgpt
</code></pre></div>
<h3 id="_9"><a class="toclink" href="../../%E9%9A%8F%E8%BA%ABwifi%E5%B7%A5%E5%85%B7%E5%88%B7%E6%9C%BA/#_9">参考</a></h3>
<p>https://forum.openwrt.org/t/uf896-qualcomm-msm8916-lte-router-384mib-ram-2-4gib-flash-android-openwrt/131712/160
https://www.kancloud.cn/handsomehacker/openstick/2636505</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-08-12 17:39:12+00:00">2023年8月12日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="pve"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/">pve入门</a></h2>
<h3 id="lxc"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#lxc">lxc 配置</a></h3>
<p>pve使用lxc来运行容器而不是docker。 docker对应的“镜像”概念在pve里叫<code>模板(template)</code>，默认的pve容器模板是从官网下载，非常慢，可以替换成清华源。另外在模板列表里面的模板都是比较新的，老版本可以上<a href="https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/">清华源</a>上找，例如centos7，然后通过url来上传，怎样都非常方便。</p>
<h4 id="_1"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#_1">容器网络问题</a></h4>
<p>有的容器模板没有安装红帽的NetworkManger，这导致创建容器时选择的DHCP网卡配置不会生效，即使给网卡设置静态ip也不行。有个解决办法是启动后再加一个静态ip的网卡，这样容器就有网络访问权限了，然后赶紧安装NetworkManger吧。</p>
<h4 id="console"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#console">低版本容器启动不能进入console的问题</a></h4>
<p>如果systemd的版本低于232，启动容器时pve提示:WARN: old systemd (&lt; v232) detected, container won't run in a pure cgroupv2 environment!<br />
也打不开控制台，只能通过在宿主机上执行 <code>pct enter id</code>来进入容器。网上有帖子说在容器里面执行软件更新后，可以恢复，也许是systemd版本更新了，但是这个方法不适用于centos7。最后只能通过修改宿主机的grub，修改启动参数:
<div class="highlight"><pre><span></span><code>#/etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT=&quot;systemd.unified_cgroup_hierarchy=0 quiet&quot;
</code></pre></div>
再执行<code>update-grub</code>命令，最后重启宿主机后问题解决。</p>
<h4 id="_2"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#_2">低版本容器问题</a></h4>
<p>pve的容器ENTERPOINT都是<code>/sbin/init</code>，跟我现在公司的管理docker方式相同。 会启动systemd，包括sshd等，对于远程访问非常方便。但是版本低的容器启动时不仅无法进入控制台，而且不会启动systemd。手动使用systemctl启动sshd时会失败，因为dbus没有启动，而启动dbus也失败。总之新版本容器就不会有这个问题，总之要配置启动参数。</p>
<p>对于通过/sbin/init来启动sshd的方式值得讨论，因为通过在Dockerfile中设置<code>ENTRYPOINT service ssh restart &amp;&amp; bash</code>也可以有相同的效果。而公司的大量容器都启动systemd时，会启动udev服务，这时硬件故障，直接导致宿主机卡死。</p>
<h4 id="map-directory-to-lxc-container"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#map-directory-to-lxc-container">map directory to lxc container</a></h4>
<p>pct set 110 -mp0 /srv/music,mp=/srv/music</p>
<h3 id="_3"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#_3">虚拟机配置声音</a></h3>
<p>我安装过一个win7的虚拟机作为测试环境用，而且需要使用音频，在添加音频网卡时，使用了SPICE驱动，会导致虚拟机无法启动，必须将显示器的驱动也改成SPICE。然而我使用remmina来远程访问这个虚拟机，听不到声音。 最后将音频驱动改为None，然后remmina的advance标签卡的<code>Auido output mode</code>设置<code>Local</code>就能听到声音了，虽然声音质量不佳，不过勉强能用!</p>
<h3 id="_4"><a class="toclink" href="../../pve%E5%85%A5%E9%97%A8/#_4">参考</a></h3>
<ul>
<li>https://forum.proxmox.com/threads/solved-warn-old-systemd-v232-detected-container-wont-run-in-a-pure-cgroupv2-environment.114736/</li>
<li>https://stackoverflow.com/questions/25135897/how-to-automatically-start-a-service-when-running-a-docker-container/32179054#32179054</li>
</ul>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-08-09 00:00:00+00:00">2023年8月9日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="ibus-setup"><a class="toclink" href="../../ibus-setup/">ibus-setup</a></h2>
<p>这里记录下ibus的配置记录，重新安装了系统，默认安装的ibus。之前用的fcitx5还不错，不过都尝试下。遇到两个问题：</p>
<h3 id="firefox"><a class="toclink" href="../../ibus-setup/#firefox">firefox里面单击选中的文字触发删除</a></h3>
<p>之前安装的ibus-pinyin, 重新安装ibus-libpinyin后解决。<a href="https://askubuntu.com/questions/620454/when-chinese-ibus-input-is-on-selecting-text-on-firefox-textareas-makes-the-tex">参考</a></p>
<h3 id="_1"><a class="toclink" href="../../ibus-setup/#_1">配置默认输入法</a></h3>
<p>作为一名程序员，默认英文输入是基本素质，在fcitx5中强制的英文输入法是默认输入法。但ibus中不是，但可以通过dbus来修改。打开dconf-editor，依次找到<code>dconf-editor</code> -&gt; <code>desktop</code> -&gt; <code>ibus</code> -&gt; <code>general</code>，直接修改<code>preload-engines</code>的用户定义顺序，<code>engines-order</code>会跟随变化。将<code>ibus:us:en</code>提到<code>ibus-pinyin</code>数组前面就可以了。<a href="https://bbs.archlinux.org/viewtopic.php?id=174235">参考</a></p>
<h3 id="ibus"><a class="toclink" href="../../ibus-setup/#ibus">ibus 体验</a></h3>
<p>ibus中的好像输入表情要容易些。</p>
<h3 id="gnome-ibus"><a class="toclink" href="../../ibus-setup/#gnome-ibus">gnome 配置ibus</a></h3>
<p>最近切换到gnome-wayland， 配置ibus花了挺多时间。问题跟网上说的什么locale无关，gnome中的locale文件是修改配置时自动更新的。最终无头无脑卸载了fcitx相关的东西，并且重装了ibus和ibus-libpinyin，然后可能是重启后成功。</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-08-02 00:00:00+00:00">2023年8月2日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="libavcodec"><a class="toclink" href="../../libavcodec%E4%BD%BF%E7%94%A8/">libavcodec使用</a></h2>
<p>记录ffmpeg的学习系列，这是关于AVCodecContext的部分。</p>
<h3 id="sample_fmt"><a class="toclink" href="../../libavcodec%E4%BD%BF%E7%94%A8/#sample_fmt">sample_fmt</a></h3>
<p>解码器avctx中的sample_fmt,是解码后的原始音频（PCM）采样格式，几乎所有的音频格式（amr,mp3）解码后都是PCM。但是采样格式可能不同，这个是由解码器来设定的。
具体在打开解码器的时候<code>avcodec_open2</code>, 需要传入解码解码avctx, 这个函数会调用解码器的<code>init</code>函数，从而将解码器的设定同步到avctx中。
对于编码器而言，这个值由是用户自己设置。如注释所说：</p>
<div class="highlight"><pre><span></span><code>    /**
     * audio sample format
     * - encoding: Set by user.
     * - decoding: Set by libavcodec.
     */
    enum AVSampleFormat sample_fmt;  ///&lt; sample format
</code></pre></div>
<p>所有的采样格式。因为工作需要解码amr, 先是自己基于opencore开发的，解码后是S16（即AV_SAMPLE_FMT_S16）, 而用ffmpeg解码后是AV_SAMPLE_FMT_FLTP, 这样的话重采样一次，效率低。后来发现ffmpeg有两套amr解码实现，选择opencore版本就是S16了。
<div class="highlight"><pre><span></span><code>enum AVSampleFormat {
    AV_SAMPLE_FMT_NONE = -1,
    AV_SAMPLE_FMT_U8,          ///&lt; unsigned 8 bits
    AV_SAMPLE_FMT_S16,         ///&lt; signed 16 bits
    AV_SAMPLE_FMT_S32,         ///&lt; signed 32 bits
    AV_SAMPLE_FMT_FLT,         ///&lt; float
    AV_SAMPLE_FMT_DBL,         ///&lt; double

    AV_SAMPLE_FMT_U8P,         ///&lt; unsigned 8 bits, planar
    AV_SAMPLE_FMT_S16P,        ///&lt; signed 16 bits, planar
    AV_SAMPLE_FMT_S32P,        ///&lt; signed 32 bits, planar
    AV_SAMPLE_FMT_FLTP,        ///&lt; float, planar
    AV_SAMPLE_FMT_DBLP,        ///&lt; double, planar
    AV_SAMPLE_FMT_S64,         ///&lt; signed 64 bits
    AV_SAMPLE_FMT_S64P,        ///&lt; signed 64 bits, planar

    AV_SAMPLE_FMT_NB           ///&lt; Number of sample formats. DO NOT USE if linking dynamically
};
</code></pre></div></p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-07-21 00:00:00+00:00">2023年7月21日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="docker-network"><a class="toclink" href="../../docker-network/">docker network</a></h2>
<p>记录一次docker的网络问题，以及学到的知识。</p>
<h3 id="_1"><a class="toclink" href="../../docker-network/#_1">背景</a></h3>
<p>公司用docker容器替代虚拟机来隔离，用来ssh登录以及运行不同的服务。容器连接了双网络，一个用来访问同宿主机上的容器，另一个用来从其他主机访问。</p>
<h3 id="_2"><a class="toclink" href="../../docker-network/#_2">问题</a></h3>
<p>宿主机重启之后，容器无法访问。需要手动改路由。</p>
<h3 id="_3"><a class="toclink" href="../../docker-network/#_3">解决办法</a></h3>
<p>每次修改路由麻烦，后面发现两个网络都是macvlan时，存在无法没有网络。</p>
<h3 id="_4"><a class="toclink" href="../../docker-network/#_4">创建桥接物理网卡</a></h3>
<p>这是需要指定parent为物理网卡，既然是桥接物理网卡，就能从其他宿主机访问了。
<div class="highlight"><pre><span></span><code>docker network create -d bridge   --subnet=10.9.3.0/24   --gateway=10.9.3.1   -o parent=ens39f0 public_net_bridge
</code></pre></div></p>
<p><div class="highlight"><pre><span></span><code>docker network create -d macvlan  --subnet=10.9.3.0/24   --gateway=10.9.3.1   -o parent=ens39f0 public_net_macvlan
</code></pre></div>
这两个由于使用的同一个网段/网卡，所以不可能同时存在。也许可以通过指定不同的ip-range来实现吗？</p>
<h3 id="_5"><a class="toclink" href="../../docker-network/#_5">创建桥接虚拟网卡</a></h3>
<p>这种网络就不能从非宿主机的其他主机访问，只能在同宿机下的容器之间访问。我称之为私有网络 
<div class="highlight"><pre><span></span><code>docker network create -d bridge   private_net_bridge
</code></pre></div></p>
<p><div class="highlight"><pre><span></span><code>docker network create -d macvlan  private_net_macvlan
</code></pre></div>
这里没有指定网络地址</p>
<h3 id="iperf"><a class="toclink" href="../../docker-network/#iperf">iperf测速</a></h3>
<p>发现无论桥接物理网卡还是虚拟网卡，macvlan都要比bridge快</p>
<ul>
<li>
<p>私有网络
bridge 模式分别测得: 20.4 Gbits/sec 22.6 Gbits/sec 23.0 Gbits/sec
macvlan 模式分别测得: 26.1 Gbits/sec 24.4 Gbits/sec 26.7 Gbits/sec</p>
</li>
<li>
<p>桥接物理网卡
macvlan: 25.7 Gbits/sec 25.5 Gbits/sec 27.3 Gbits/sec
bridge: 20.2 Gbits/sec 20.4 Gbits/sec 23.2 Gbits/sec</p>
</li>
</ul>
<h3 id="_6"><a class="toclink" href="../../docker-network/#_6">顺便说下容器连接多网络的方法</a></h3>
<p>容器启动的时候，只能指定一个网络, 然后启动之后，可以通过命令来连接多网络，可以在启动时设置--restart=alway,这样重启主机后自动连接双网络
<div class="highlight"><pre><span></span><code>docker network connect private_net_bridge test_container
</code></pre></div></p>
<h3 id="_7"><a class="toclink" href="../../docker-network/#_7">杂项</a></h3>
<p>网络配置挺复杂，macvlan 下面还分
* Bridge mode, 就是常见的模式，走宿主机的网卡
* 802.1q trunk bridge mode, 先在物理网卡上创建子网卡</p>
<h4 id="ipvlan"><a class="toclink" href="../../docker-network/#ipvlan">IPvlan</a></h4>
<p>除了bridge macvlan之外，还有IPvlan, 这种模式下，所有的容器都使用相同的mac地址，所以如果容器使用dhcp来获取ip地址，则可能有问题。 访问其他容器时，可以配置来使用macvlan模式。</p>
<h4 id="overlay"><a class="toclink" href="../../docker-network/#overlay">overlay</a></h4>
<p>docker network driver 除了上面的三种模式之外，还有overlay, 用于连接不同主机的网络，可以跨宿主机访问容器。</p>
<h3 id="_8"><a class="toclink" href="../../docker-network/#_8">宿主机网络类型</a></h3>
<p>我通常会创建bridge并将物理网卡设为从卡，然后创建虚拟网桥，用于访问虚拟机。而除了bridge, 还有bond,另外还有team。总而言之，bridge可以使不同的虚拟机（client）使用网卡的虚拟化功能，而bond可以将不同的网卡绑定，实现负载均衡。如果两个网卡分别有1M带宽，那么bond后的网卡则有2M带宽。下面的链接先bonding,然后在bonding网卡上创建bridge网卡。<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-vlan_on_bond_and_bridge_using_the_networkmanager_command_line_tool_nmcli">参考</a></p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-07-18 00:00:00+00:00">2023年7月18日</time></li>
        
        
          
          <li class="md-meta__item">
            
              需要 1 分钟阅读时间
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="linux"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/">Linux下的邮件配置</a></h2>
<p>这里记录Linux（debian）下如何使用Mutt查看邮件，用fetchmail接收邮件，用msmtp发送邮件以及使用maildrop来筛选邮件。与其他邮件客户端相比，如thunderbird，他们使用的在线登陆方式，没有下载邮件来离线访问。而mutt支持离线访问本地的邮件，也可以配置为访问邮件服务器，查看服务器上的邮件。 在线方式除了离线不可用的缺点之外，每次打开mutt需要登陆，非常慢。
我这里的配置是比较简陋，适合公司少量邮件的场景。又因为目前使用的Byobu-terminal终端，其邮件提醒是基于/var/mail/spool/$USER文件。邮件比较多或者附件比较大的话，相较于用文件夹来存储邮件，这种方式会比较慢。</p>
<h3 id="_1"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/#_1">软件安装</a></h3>
<p>需要安装 fetchmail, maildrop, mutt</p>
<h3 id="_2"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/#_2">接收配置</a></h3>
<p>在家目录下创建文件.fetchmailrc
<div class="highlight"><pre><span></span><code>poll imap.exmail.qq.com
  protocol IMAP
  user &quot;example@example.com&quot;
  password &quot;password&quot;
  keep
  #fetchall
  ssl

mimedecode
mda &quot;/usr/bin/maildrop&quot;
</code></pre></div>
keep 方式不会删除服务器上的邮件。然后启动定时任务，自动检查新邮件
<div class="highlight"><pre><span></span><code>systemctl --user enable --now fetchmail.service
</code></pre></div></p>
<p>service 内容
<div class="highlight"><pre><span></span><code># /usr/lib/systemd/user/fetchmail.service
# or any other location per man:systemd.unit(5)
[Unit]
Description=Fetchmail Daemon
Documentation=man:fetchmail(1)

[Service]
ExecStart=fetchmail --nodetach --daemon 300
ExecStop=fetchmail --quit
Restart=always

[Install]
WantedBy=default.target
</code></pre></div></p>
<h3 id="_3"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/#_3">发送配置</a></h3>
<p>在家目录创建文件.msmtproc，填入发送的验证信息
<div class="highlight"><pre><span></span><code>defaults
auth           on
tls            on
tls_starttls off
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        ~/.msmtp.log

# exmail
account        office
host           smtp.exmail.qq.com
port           465
from           example@example.com
user           example@example.com
password       password
</code></pre></div></p>
<h3 id="mutt"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/#mutt">mutt配置</a></h3>
<p>由于我不想删除/var/mail/里面的邮件，这样才能在byobu-terminal中提醒，所以没有配置maildrop。最后需要配置mutt读取/var/mail/$USER。在家目录或者xdg配置目录（~/.config/mutt）创建文件.muttrc/muttrc
<div class="highlight"><pre><span></span><code>set spoolfile=/var/spool/mail/jimery
set header_cache=~/.cache/mutt
set send_charset=&quot;utf-8&quot;
</code></pre></div></p>
<p>这样就能查看邮件了。 在mutt里面手动管理邮件，存档或者删除。</p>
<h3 id="mutt_1"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/#mutt_1">mutt使用</a></h3>
<p>其实不用mutt, 直接用mail也可以，这个默认访问/var/mail/$USER,是Linux默认的邮件工具。 mutt能很方便调用msmtproc来发送邮件。</p>
<h3 id="maildrop-in-arch"><a class="toclink" href="../../linux%E4%B8%8B%E7%9A%84%E9%82%AE%E4%BB%B6%E9%85%8D%E7%BD%AE/#maildrop-in-arch">maildrop in Arch</a></h3>
<p>又换回Arch了，发现maildrop在AUR里，而且还依赖好几个AUR, 而自己编译只依赖courier-unicode库。</p>
<ol>
<li>下载courier-unicode源码</li>
<li>./configure --prefix=$HOME/.local --enable-shared=no --with-pic  # 静态编译，指定安装到用户根目录</li>
<li>make &amp;&amp; make install # 必须安装否则编译maildrop的时候找不到这个库，即使指定路径也不行。 </li>
<li>下载maildrop源码</li>
<li>./configure --prefix=/home/hst/.local --enable-shared=no # 静态编译，指定安装到用户根目录</li>
<li>make</li>
<li>验证是静态链接的courier-unicode，确认<code>ldd ./libs/maildrop/maildrop</code> 里面没有'courier-unicode'</li>
</ol>
<p>Arch里面创建用户时默认没有对应的邮箱文件，直接手动创建<code>sudo touch "/var/spool/mail/$(whoami)"</code>, 还有chmod</p>
    
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <span class="md-pagination__current">1</span> <a class="md-pagination__link" href="page/2/">2</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../2024/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 2024">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                2024
              </div>
            </div>
          </a>
        
        
          
          <a href="../2022/" class="md-footer__link md-footer__link--next" aria-label="下一页: 2022">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                2022
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../js/tex-mml-chtml.js"></script>
      
        <script src="../../../js/mermaid.min.js"></script>
      
    
  </body>
</html>